{% extends 'base.html' %}

{% block title %}Profile - {{ user.username }}{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div style="margin-bottom: 30px;">
        <h1 style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
            <span style="font-size: 48px;">üë§</span>
            <span>Your Profile</span>
        </h1>
        <p style="color: #666; font-size: 16px;">
            Manage your account and view active devices
        </p>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
        <!-- Account Info Card -->
        <div class="card">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4285f4 0%, #3367d6 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold;">
                    {{ user.username|first|upper }}
                </div>
                <div>
                    <h3 style="margin: 0;">{{ user.username }}</h3>
                    <p style="color: #666; margin: 5px 0 0 0;">
                        Member since {{ user.date_joined|date:"F Y" }}
                    </p>
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span style="color: #666;">Account Type:</span>
                    <span style="font-weight: 600;">
                        {% if user.is_superuser %}
                            <span style="color: #28a745;">üîë Super Admin</span>
                        {% elif user.is_staff %}
                            <span style="color: #17a2b8;">üëî Staff</span>
                        {% else %}
                            <span style="color: #6c757d;">üë§ Regular User</span>
                        {% endif %}
                    </span>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span style="color: #666;">Email:</span>
                    <span style="font-weight: 600;">
                        {{ user.email|default:"Not set" }}
                    </span>
                </div>
                
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #666;">Last Login:</span>
                    <span style="font-weight: 600;">
                        {{ user.last_login|date:"M d, Y H:i"|default:"Never" }}
                    </span>
                </div>
            </div>
            
            <div style="margin-top: 25px; display: flex; gap: 15px;">
                <a href="{% url 'emails:inbox' %}" class="btn btn-primary">
                    üì• Go to Inbox
                </a>
                {% if user.is_superuser or user.is_staff %}
                    <a href="/admin/" target="_blank" class="btn btn-secondary">
                        ‚öôÔ∏è Admin Panel
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Current Device Card -->
        <div class="card">
            <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 25px;">
                <span>üì±</span>
                <span>Current Device</span>
            </h3>
            
            {% if current_device %}
                <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-weight: 600; font-size: 18px;">
                            {{ current_device.device_name }}
                        </span>
                        <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            ‚úÖ Active
                        </span>
                    </div>
                    
                    <div style="color: #666; font-size: 14px; margin-bottom: 10px;">
                        Device ID: <code style="background: #f1f3f4; padding: 2px 6px; border-radius: 4px; font-size: 12px;">{{ current_device.device_id|truncatechars:20 }}</code>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 15px;">
                        <div>
                            <span style="color: #666; font-size: 13px;">Read Permission</span>
                            <div style="margin-top: 5px;">
                                {% if current_device.read_permission %}
                                    <span class="permission-badge permission-read">
                                        ‚úÖ Allowed
                                    </span>
                                {% else %}
                                    <span class="permission-badge permission-none">
                                        ‚ùå Denied
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div>
                            <span style="color: #666; font-size: 13px;">Write Permission</span>
                            <div style="margin-top: 5px;">
                                {% if current_device.write_permission %}
                                    <span class="permission-badge permission-write">
                                        ‚úÖ Allowed
                                    </span>
                                {% else %}
                                    <span class="permission-badge permission-none">
                                        ‚ùå Denied
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; color: #888; font-size: 13px;">
                        Last active: {{ current_device.last_login|timesince }} ago
                    </div>
                </div>
                
                {% if current_device.can_read and not current_device.can_write %}
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 5px solid #ffc107;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 20px;">‚ö†Ô∏è</span>
                            <div>
                                <strong>Write Permission Required</strong>
                                <p style="margin: 5px 0 0 0; color: #856404;">
                                    You can read emails but cannot compose new ones.
                                    Contact admin to enable write permission.
                                </p>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
            {% else %}
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 48px; margin-bottom: 15px;">üîç</div>
                    <h4 style="color: #666; margin-bottom: 10px;">No Active Device</h4>
                    <p style="color: #888; margin-bottom: 20px;">
                        You are not currently logged in from any device.
                    </p>
                    <a href="{% url 'accounts:login' %}" class="btn btn-primary">
                        üîë Login Again
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Active Devices Table -->
    <div class="card">
        <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 25px;">
            <span>üíª</span>
            <span>All Active Devices ({{ device_count }})</span>
        </h3>
        
        {% if active_devices %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e0e0e0;">Device Name</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e0e0e0;">Permissions</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e0e0e0;">Last Active</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e0e0e0;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for device in active_devices %}
                            <tr style="border-bottom: 1px solid #f0f0f0;">
                                <td style="padding: 15px;">
                                    <div style="font-weight: 600;">{{ device.device_name }}</div>
                                    <div style="font-size: 12px; color: #888; margin-top: 5px;">
                                        ID: {{ device.device_id|truncatechars:15 }}
                                    </div>
                                </td>
                                <td style="padding: 15px;">
                                    <div style="display: flex; gap: 10px;">
                                        <span class="permission-badge {% if device.read_permission %}permission-read{% else %}permission-none{% endif %}">
                                            {% if device.read_permission %}üìñ Read{% else %}‚ùå Read{% endif %}
                                        </span>
                                        <span class="permission-badge {% if device.write_permission %}permission-write{% else %}permission-none{% endif %}">
                                            {% if device.write_permission %}‚úèÔ∏è Write{% else %}‚ùå Write{% endif %}
                                        </span>
                                    </div>
                                </td>
                                <td style="padding: 15px;">
                                    {{ device.last_login|date:"M d, H:i" }}
                                    <div style="font-size: 12px; color: #888; margin-top: 3px;">
                                        {{ device.last_login|timesince }} ago
                                    </div>
                                </td>
                                <td style="padding: 15px;">
                                    {% if device.is_active %}
                                        <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                            ‚úÖ Active
                                        </span>
                                    {% else %}
                                        <span style="background: #6c757d; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                            ‚ùå Inactive
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 25px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">‚ÑπÔ∏è</span>
                    <div>
                        <strong>Device Management Note</strong>
                        <p style="margin: 5px 0 0 0; color: #1565c0;">
                            Admin can change permissions for any device. 
                            Contact admin if you need access from other devices.
                        </p>
                    </div>
                </div>
            </div>
            
        {% else %}
            <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                <h4 style="color: #666; margin-bottom: 10px;">No Active Devices</h4>
                <p style="color: #888; margin-bottom: 20px;">
                    You don't have any active devices at the moment.
                </p>
                <a href="{% url 'accounts:login' %}" class="btn btn-primary">
                    üîë Login to Activate Device
                </a>
            </div>
        {% endif %}
    </div>
    
    <!-- Action Buttons -->
    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 40px;">
        <a href="{% url 'emails:inbox' %}" class="btn btn-primary">
            üì• Back to Inbox
        </a>
        <a href="{% url 'accounts:logout' %}" class="btn btn-danger" 
           onclick="return confirm('Are you sure you want to logout from all devices?');">
            üö™ Logout All Devices
        </a>
    </div>
</div>
{% endblock %}